{% extends 'game/base.html' %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç - –°–∞–π—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤{% endblock %}

{% block content %}
<div class="add-recipe-container">
    <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ—Ü–µ–ø—Ç</h2>
    
    {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
    
    <form method="post" enctype="multipart/form-data" class="recipe-form">
        {% csrf_token %}
        
        <div class="form-section">
            <h3>üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
            
            <div class="form-group">
                <label for="{{ recipe_form.title.id_for_label }}">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç–∞ *</label>
                {{ recipe_form.title }}
                {% if recipe_form.title.errors %}
                    <div class="error">{{ recipe_form.title.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ recipe_form.description.id_for_label }}">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                {{ recipe_form.description }}
                {% if recipe_form.description.errors %}
                    <div class="error">{{ recipe_form.description.errors }}</div>
                {% endif %}
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="{{ recipe_form.category.id_for_label }}">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    {{ recipe_form.category }}
                </div>
                
                <div class="form-group">
                    <label for="{{ recipe_form.cooking_time.id_for_label }}">–í—Ä–µ–º—è (–º–∏–Ω) *</label>
                    {{ recipe_form.cooking_time }}
                </div>
                
                <div class="form-group">
                    <label for="{{ recipe_form.servings.id_for_label }}">–ü–æ—Ä—Ü–∏–π *</label>
                    {{ recipe_form.servings }}
                </div>
            </div>
            
            <div class="form-group">
                <label for="{{ recipe_form.image.id_for_label }}">–§–æ—Ç–æ –±–ª—é–¥–∞ *</label>
                {{ recipe_form.image }}
                {% if recipe_form.image.errors %}
                    <div class="error">{{ recipe_form.image.errors }}</div>
                {% endif %}
            </div>
            
        </div>
        
        <div class="form-section">
            <h3>üìù –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h3>
            <p class="help-text">–î–æ–±–∞–≤—å—Ç–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–µ—Ü–µ–ø—Ç–∞</p>
            
            {{ ingredient_formset.management_form }}
            <div id="ingredient-forms">
                {% for form in ingredient_formset %}
                    <div class="ingredient-form">
                        {{ form.id }}
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <input type="text" name="{{ form.name.html_name }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞" class="form-control" value="{{ form.name.value|default:'' }}">
                            </div>
                            <div class="form-group flex-1">
                                <input type="text" name="{{ form.quantity.html_name }}" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" class="form-control" value="{{ form.quantity.value|default:'' }}">
                            </div>
                            <div class="form-group flex-1">
                                <input type="text" name="{{ form.unit.html_name }}" placeholder="–ï–¥. –∏–∑–º." class="form-control" value="{{ form.unit.value|default:'' }}">
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <button type="button" class="btn-add-more" onclick="addIngredient()">+ –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</button>
        </div>
        
        <div class="form-section">
            <h3>üë®‚Äçüç≥ –®–∞–≥–∏ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è</h3>
            <p class="help-text">–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –ø–æ—à–∞–≥–æ–≤–æ</p>
            
            {{ step_formset.management_form }}
            <div id="step-forms">
                {% for form in step_formset %}
                    <div class="step-form">
                        {{ form.id }}
                        <div class="form-row">
                            <div class="form-group" style="max-width: 100px;">
                                <input type="number" name="{{ form.step_number.html_name }}" placeholder="‚Ññ" class="form-control" value="{{ form.step_number.value|default:'' }}" min="1">
                            </div>
                            <div class="form-group flex-1">
                                <textarea name="{{ form.instruction.html_name }}" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞" class="form-control" rows="2">{{ form.instruction.value|default:'' }}</textarea>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <button type="button" class="btn-add-more" onclick="addStep()">+ –î–æ–±–∞–≤–∏—Ç—å —à–∞–≥</button>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-submit">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</button>
            <a href="{% url 'home' %}" class="btn-cancel">–û—Ç–º–µ–Ω–∞</a>
        </div>
        
        <p class="info-text">
            ‚ÑπÔ∏è –í–∞—à —Ä–µ—Ü–µ–ø—Ç –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π –Ω–∞ —Å–∞–π—Ç–µ.
        </p>
    </form>
</div>

<script>
let ingredientCount = {{ ingredient_formset.total_form_count|default:3 }};
let stepCount = {{ step_formset.total_form_count|default:3 }};

function addIngredient() {
    const container = document.getElementById('ingredient-forms');
    const newForm = document.createElement('div');
    newForm.className = 'ingredient-form';
    newForm.innerHTML = `
        <div class="form-row">
            <div class="form-group flex-2">
                <input type="text" name="ingredients-${ingredientCount}-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞" class="form-control">
            </div>
            <div class="form-group flex-1">
                <input type="text" name="ingredients-${ingredientCount}-quantity" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" class="form-control">
            </div>
            <div class="form-group flex-1">
                <input type="text" name="ingredients-${ingredientCount}-unit" placeholder="–ï–¥. –∏–∑–º." class="form-control">
            </div>
        </div>
    `;
    container.appendChild(newForm);
    ingredientCount++;
    document.getElementById('id_ingredients-TOTAL_FORMS').value = ingredientCount;
}

function addStep() {
    const container = document.getElementById('step-forms');
    const newForm = document.createElement('div');
    newForm.className = 'step-form';
    newForm.innerHTML = `
        <div class="form-row">
            <div class="form-group" style="max-width: 100px;">
                <input type="number" name="steps-${stepCount}-step_number" placeholder="‚Ññ" class="form-control" value="${stepCount + 1}" min="1">
            </div>
            <div class="form-group flex-1">
                <textarea name="steps-${stepCount}-instruction" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞" class="form-control" rows="2"></textarea>
            </div>
        </div>
    `;
    container.appendChild(newForm);
    stepCount++;
    document.getElementById('id_steps-TOTAL_FORMS').value = stepCount;
}
</script>
{% endblock %}
