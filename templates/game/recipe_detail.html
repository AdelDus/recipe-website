{% extends 'game/base.html' %}

{% block title %}{{ recipe.title }} - –°–∞–π—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤{% endblock %}

{% block content %}
<style>
    .recipe-detail {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .recipe-header {
        text-align: center;
        margin-bottom: 30px;
    }
    .recipe-header h2 {
        color: #333;
        font-size: 2.5em;
        margin-bottom: 10px;
    }
    .recipe-image {
        width: 100%;
        max-width: 600px;
        height: 400px;
        object-fit: cover;
        border-radius: 10px;
        margin: 20px auto;
        display: block;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .recipe-meta {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin: 20px 0;
        font-size: 1.1em;
        color: #666;
    }
    .recipe-description {
        font-size: 1.1em;
        line-height: 1.6;
        color: #555;
        margin: 20px 0;
        text-align: center;
    }
    .like-button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        font-size: 1.2em;
        border-radius: 25px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        margin: 20px 0;
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }
    .like-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    .like-button:active {
        transform: translateY(0);
    }
    .like-count {
        font-weight: bold;
        font-size: 1.1em;
    }
    .section {
        margin: 30px 0;
    }
    .section h3 {
        color: #667eea;
        font-size: 1.8em;
        margin-bottom: 15px;
        border-bottom: 3px solid #667eea;
        padding-bottom: 10px;
    }
    .ingredients-list {
        list-style: none;
        padding: 0;
    }
    .ingredients-list li {
        padding: 10px;
        margin: 5px 0;
        background: #f9f9f9;
        border-left: 4px solid #667eea;
        border-radius: 5px;
    }
    .steps-list {
        list-style: none;
        padding: 0;
        counter-reset: step-counter;
    }
    .steps-list li {
        counter-increment: step-counter;
        padding: 15px;
        margin: 15px 0;
        background: #f9f9f9;
        border-radius: 5px;
        position: relative;
        padding-left: 60px;
    }
    .steps-list li::before {
        content: counter(step-counter);
        position: absolute;
        left: 15px;
        top: 15px;
        background: #667eea;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    }
    .back-link {
        display: inline-block;
        margin-bottom: 20px;
        color: #667eea;
        text-decoration: none;
        font-size: 1.1em;
    }
    .back-link:hover {
        text-decoration: underline;
    }
    .messages {
        margin: 20px 0;
    }
    .message {
        padding: 12px 20px;
        border-radius: 5px;
        margin-bottom: 10px;
    }
    .message.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }
    .message.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
    }
    .comment-form {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
    }
    .comment-form h4 {
        color: #333;
        margin-bottom: 15px;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 1em;
        font-family: inherit;
        transition: border-color 0.3s;
    }
    .form-group input:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }
    .submit-comment {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 30px;
        font-size: 1.1em;
        border-radius: 5px;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .submit-comment:hover {
        transform: translateY(-2px);
    }
    .comments-list {
        margin-top: 30px;
    }
    .comment {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .comment-author {
        color: #667eea;
        font-size: 1.1em;
    }
    .comment-date {
        color: #999;
        font-size: 0.9em;
    }
    .comment-text {
        color: #555;
        line-height: 1.6;
        margin: 0;
    }
    .no-comments {
        text-align: center;
        color: #999;
        font-style: italic;
        padding: 20px;
    }
</style>

<a href="{% url 'home' %}" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Ä–µ—Ü–µ–ø—Ç–æ–≤</a>

<div class="recipe-detail">
    <div class="recipe-header">
        <h2>{{ recipe.title }}</h2>
        <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" class="recipe-image">
        <div class="recipe-meta">
            <span>‚è±Ô∏è –í—Ä–µ–º—è: {{ recipe.cooking_time }} –º–∏–Ω—É—Ç</span>
            <span>üçΩÔ∏è –ü–æ—Ä—Ü–∏–π: {{ recipe.servings }}</span>
        </div>
        <p class="recipe-description">{{ recipe.description }}</p>
        
        <form method="post" action="{% url 'like_recipe' recipe.id %}" id="like-form" style="text-align: center;">
            {% csrf_token %}
            <button type="submit" class="like-button">
                <span>‚ù§Ô∏è</span>
                <span>–ù—Ä–∞–≤–∏—Ç—Å—è</span>
                <span class="like-count" id="like-count">{{ recipe.likes }}</span>
            </button>
        </form>
    </div>

    <div class="section">
        <h3>üìù –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h3>
        <ul class="ingredients-list">
            {% for ingredient in ingredients %}
                <li>{{ ingredient.name }} ‚Äî {{ ingredient.quantity }} {{ ingredient.unit }}</li>
            {% empty %}
                <li>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã</li>
            {% endfor %}
        </ul>
    </div>

    <div class="section">
        <h3>üë®‚Äçüç≥ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
        <ul class="steps-list">
            {% for step in steps %}
                <li>{{ step.instruction }}</li>
            {% empty %}
                <li>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã</li>
            {% endfor %}
        </ul>
    </div>

    <div class="section">
        <h3>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments.count }})</h3>
        
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="message {{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
        
        <div class="comment-form">
            <h4>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h4>
            <form method="post">
                {% csrf_token %}
                <div class="form-group">
                    <input type="text" name="author_name" placeholder="–í–∞—à–µ –∏–º—è" required maxlength="100">
                </div>
                <div class="form-group">
                    <textarea name="text" placeholder="–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" required rows="4"></textarea>
                </div>
                <button type="submit" class="submit-comment">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </form>
        </div>

        <div class="comments-list">
            {% for comment in comments %}
                <div class="comment">
                    <div class="comment-header">
                        <strong class="comment-author">{{ comment.author_name }}</strong>
                        <span class="comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</span>
                    </div>
                    <p class="comment-text">{{ comment.text }}</p>
                </div>
            {% empty %}
                <p class="no-comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
document.getElementById('like-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = this;
    const button = form.querySelector('.like-button');
    const countElement = document.getElementById('like-count');
    
    fetch(form.action, {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        countElement.textContent = data.likes;
        button.style.animation = 'pulse 0.3s';
        setTimeout(() => button.style.animation = '', 300);
    })
    .catch(error => console.error('Error:', error));
});
</script>

<style>
@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}
</style>
{% endblock %}
