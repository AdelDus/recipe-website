{% extends 'game/base.html' %}

{% block title %}–ò–∑–±—Ä–∞–Ω–Ω–æ–µ - –°–∞–π—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤{% endblock %}

{% block content %}
<h2>‚≠ê –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã</h2>

<div class="recipe-gallery">
    {% for recipe in recipes %}
        <div class="recipe-card">
            <button class="favorite-btn active" 
                    data-recipe-id="{{ recipe.id }}"
                    title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ">
                ‚≠ê
            </button>
            <a href="{% url 'recipe_detail' recipe.id %}">
                <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
                <h3>{{ recipe.title }}</h3>
            </a>
            <div class="recipe-info">
                <span class="cooking-time">‚è±Ô∏è {{ recipe.cooking_time }} –º–∏–Ω</span>
                <span class="servings">üçΩÔ∏è {{ recipe.servings }} –ø–æ—Ä—Ü–∏–π</span>
                <span class="likes">‚ù§Ô∏è {{ recipe.likes }}</span>
            </div>
        </div>
    {% empty %}
        <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px;">
            <p style="font-size: 3em; margin: 0;">‚≠ê</p>
            <h3 style="color: #666; margin: 20px 0;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ä–µ—Ü–µ–ø—Ç–æ–≤</h3>
            <p style="color: #999;">–î–æ–±–∞–≤–ª—è–π—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è —Ä–µ—Ü–µ–ø—Ç—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, –Ω–∞–∂–∏–º–∞—è –Ω–∞ –∑–≤–µ–∑–¥–æ—á–∫—É</p>
            <a href="{% url 'home' %}" style="display: inline-block; margin-top: 20px; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px;">
                –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ—Ü–µ–ø—Ç–∞–º
            </a>
        </div>
    {% endfor %}
</div>

<script>
// AJAX –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
document.querySelectorAll('.favorite-btn').forEach(button => {
    button.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const recipeId = this.dataset.recipeId;
        const url = `/recipe/${recipeId}/favorite/`;
        const card = this.closest('.recipe-card');
        
        fetch(url, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            // –£–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            card.style.opacity = '0';
            card.style.transform = 'scale(0.8)';
            setTimeout(() => {
                card.remove();
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Å—Ç–∞–ª–∏—Å—å –ª–∏ —Ä–µ—Ü–µ–ø—Ç—ã
                const gallery = document.querySelector('.recipe-gallery');
                if (gallery.children.length === 0) {
                    location.reload();
                }
            }, 300);
        })
        .catch(error => console.error('Error:', error));
    });
});
</script>
{% endblock %}
