{% extends 'game/base.html' %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –°–∞–π—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤{% endblock %}

{% block content %}
<h2>
    {% if search_query %}
        üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "{{ search_query }}"
    {% elif selected_category %}
        {{ selected_category.icon }} {{ selected_category.name }}
    {% else %}
        –í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã
    {% endif %}
</h2>

<div class="category-filter">
    <a href="{% url 'home' %}" class="category-btn {% if not selected_category %}active{% endif %}">
        üçΩÔ∏è –í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã
    </a>
    {% for category in categories %}
        <a href="?category={{ category.id }}" class="category-btn {% if selected_category.id == category.id %}active{% endif %}">
            {{ category.icon }} {{ category.name }}
        </a>
    {% endfor %}
</div>

<div class="recipe-gallery">
    {% for recipe in recipes %}
        <div class="recipe-card">
            <button class="favorite-btn {% if recipe.id in favorite_ids %}active{% endif %}" 
                    data-recipe-id="{{ recipe.id }}"
                    title="{% if recipe.id in favorite_ids %}–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ{% else %}–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ{% endif %}">
                ‚≠ê
            </button>
            <a href="{% url 'recipe_detail' recipe.id %}">
                <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}">
                <h3>{{ recipe.title }}</h3>
            </a>
            <div class="recipe-info">
                <span class="cooking-time">‚è±Ô∏è {{ recipe.cooking_time }} –º–∏–Ω</span>
                <span class="servings">üçΩÔ∏è {{ recipe.servings }} –ø–æ—Ä—Ü–∏–π</span>
                <span class="likes">‚ù§Ô∏è {{ recipe.likes }}</span>
            </div>
        </div>
    {% empty %}
        <p style="grid-column: 1/-1; text-align: center; color: #666;">
            {% if search_query %}
                –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ search_query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å.
            {% else %}
                –†–µ—Ü–µ–ø—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ä–µ—Ü–µ–ø—Ç —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å!
            {% endif %}
        </p>
    {% endfor %}
</div>

<script>
// AJAX –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
document.querySelectorAll('.favorite-btn').forEach(button => {
    button.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const recipeId = this.dataset.recipeId;
        const url = `/recipe/${recipeId}/favorite/`;
        
        fetch(url, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            this.classList.toggle('active');
            this.title = data.is_favorite ? '–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ' : '–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ';
        })
        .catch(error => console.error('Error:', error));
    });
});
</script>
{% endblock %}
